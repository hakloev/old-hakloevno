{% extends 'base.html' %}

{% load filters %}

{% block title %}
{{ block.super }}
&ndash; beer tasting &ndash; rating
{% endblock %}

{% block content %}
 <div class="grid">
        <div class="unit whole">
            <h1>{% if event.finished %}{% if rating %}{{ rating.beer }}{% else %}Details{% endif %}{% else %}Rating{% endif %}</h1>
        </div>
</div>
<div class="grid">
    <div class="unit whole">
        {% if breadcrumbs %}
            <ol class="breadcrumb">
                {% for name, link in breadcrumbs %}
                    {% if not forloop.last %}
                        <li><a href="{{ link }}">{{ name }}</a></li>
                    {% else %}
                        <li>{{ name }}</li>
                    {% endif %}
                {% endfor %}
            </ol>
        {% endif %}
    </div>
</div>

<div class="grid">
    <div class="unit two-thirds">
        {% if event.finished %}
            {% if rating %}
                <h2>You gave <strong>{{ rating.beer }}</strong> the following:</h2>
                <div class="beer-rating">
                    Grade: <strong>{{ rating.rating|floatformat:0 }}</strong>
                    <br/>
                    <br/>
                    {% if rating.comment|length < 1 %}
                    <strong>You gave no comment.</strong>
                    {% else %}
                    {{ rating.comment }}
                    {% endif %}
                </div>     
            {% else %}
                <h2>You didn't give this beer any rating</h2>
            {% endif %}
            <hr>
            {% if comments %}
            <h2>Others gave the follwing:</h2>
            {% for comment in comments %}
                <div class="beer-rating">
                    Grade: <strong>{{ comment.rating|floatformat:0 }}</strong>
                    <br/>
                    <br/>
                    {% if comment.comment|length < 1 %}
                        <strong>This user gave no comment.</strong>
                    {% else %}
                        {{ comment.comment }}
                    {% endif %}
                </div>
            {% endfor %}
            {% else %}
                <h2>No one else has rated this beer.</h2>
            {% endif %}
            <hr>
            <a class="button button-default" href="{% url 'tasting:beer_stats' beerid %}">Statistics</a>
        {% else %}
        <form class="form-horizontal" action="{% url 'tasting:beer_rating' event.id beercode %}" method="POST">
                {% csrf_token %}
                <fieldset>
                    <div class="form-group">
                        <label class="col-md-1">Karakter:</label>
                        <div class="col-md-12">
                            <select name="ratingvalue" id="ratingvalue">
                                {% autoescape off %}
                                   {{ rating.rating|print_select_form }}
                                {% endautoescape %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="col-md-1 control-label" for="comment">Kommentar:</label>
                        <div class="col-md-12">
                            {% if rating %}
                                
                                <div class="well well-sm">
                                    {% if rating.comment|length_is:"0" %}
                                        <strong>Du ga ikke denne ølen noen kommentar.</strong>
                                    {% else %}
                                    {{ rating.comment }}
                                    {% endif %}
                                <small><i><br><br>Sist vurdert: {{ rating.rated|date:"d.m.Y H:i" }}</i></small>
                                </div>
                            {% else %}
                                <textarea class="form-control" id="comment" name="comment" maxlength=350 rows=5></textarea>
                                {% endif %}
                                <hr>
                                <div class="alert alert-dismissable alert-warning">
                                    <button type="button" class="close" data-dismiss="alert">×</button>
                                    <h4>Advarsel!</h4>
                                    <p>Du kan ikke endre kommentar etter å ha avgitt vurdering, men du kan fortsatt endre karakter.</p>
                                </div>
                        </div>
                    </div>
                {% if rating %}
                <input class="btn btn-lg btn-danger btn-block ratingbutton" type="submit" value="Endre din karakter"/>
                {% else %}
                 <input class="btn btn-lg btn-danger btn-block ratingbutton" type="submit" value="Gi din vurdering"/>
                {% endif %}
                <input type="hidden" name="next" value="{{ next }}">
                </fieldset>
            </form>
            {% endif %}
    </div>
    {% include 'beertasting/sidebar.html' %}
</div>
{% endblock %}
{% block script_block %}
<script src="/static/js/beertasting.js"></script>
{% endblock %}
